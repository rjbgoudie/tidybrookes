<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='fsheet_add creates a new "fsheet definition", which is a specification of
how the raw flowsheet data should be extracted, filtered, cleaned and
standardised. A list of such specifications can be used on raw fsheet data
using fsheet_extract.'><title>Add and extract flowsheet items — fsheet_add • tidybrookes</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add and extract flowsheet items — fsheet_add"><meta property="og:description" content='fsheet_add creates a new "fsheet definition", which is a specification of
how the raw flowsheet data should be extracted, filtered, cleaned and
standardised. A list of such specifications can be used on raw fsheet data
using fsheet_extract.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidybrookes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/tidybrookes.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Add and extract flowsheet items</h1>
      
      <div class="d-none name"><code>fsheet_extract.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>fsheet_add</code> creates a new "fsheet definition", which is a specification of
how the raw flowsheet data should be extracted, filtered, cleaned and
standardised. A list of such specifications can be used on raw <code>fsheet</code> data
using <code>fsheet_extract</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fsheet_add</span><span class="op">(</span></span>
<span>  <span class="va">fsheet_def</span>,</span>
<span>  <span class="va">symbol</span>,</span>
<span>  <span class="va">title</span>,</span>
<span>  names <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">search_pattern</span>,</span>
<span>  search_exclude <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"numeric"</span>,</span>
<span>  silently_exclude_na_when <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silently_exclude_when <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  censoring_fn <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span>,</span>
<span>  value_as_number_fn <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"numeric"</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="cn">TRUE</span> <span class="op">~</span> <span class="va">value_as_number</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  value_as_character_fn <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"character"</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="cn">TRUE</span> <span class="op">~</span></span>
<span>    <span class="va">value_as_character</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  value_as_logical_fn <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"logical"</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="cn">TRUE</span> <span class="op">~</span> <span class="va">value_as_logical</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="cn">TRUE</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  unit_rescale_fn <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="cn">TRUE</span> <span class="op">~</span> <span class="va">value_as_number</span><span class="op">)</span>,</span>
<span>  unit_relabel_fn <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span>,</span>
<span>  coalesce_fn <span class="op">=</span> <span class="va">identity</span>,</span>
<span>  expect_before <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  expect_after <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  range_mainly_low <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  range_mainly_high <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  range_discard_below <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  range_discard_above <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">fsheet_extract</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">fsheet_def</span>,</span>
<span>  errors <span class="op">=</span> <span class="va">stop</span>,</span>
<span>  rds_only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  rds_filepath_fn <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>fsheet_def</dt>
<dd><p>A list of fsheet definitions</p></dd>


<dt>symbol</dt>
<dd><p>A short name for the flowsheet item. This should be a character
vector that is suitable to use as an R object name</p></dd>


<dt>title</dt>
<dd><p>The full name for the flowsheet item, suitable for using in
figure titles etc</p></dd>


<dt>names</dt>
<dd><p>A character vector of display names (<code>disp_name</code> in raw format)
of the flowsheet items to include</p></dd>


<dt>search_pattern</dt>
<dd><p>A character vector of potential synonymns for this
flowsheet item, in case new names (<code>disp_name</code> in raw format) for the
same item are added in future. These will be searched for in the raw data
and if any potential new names are identified, the user will be alerted to
the presence of potential new flowsheet names.</p></dd>


<dt>search_exclude</dt>
<dd><p>A character vector of flowsheet item names
(<code>disp_name</code> in raw format) that are known NOT to be relevant to this
flowsheet item.</p></dd>


<dt>type</dt>
<dd><p>Whether flowsheet item is a number or a string. Either
<code>"numeric"</code> or <code>"character"</code></p></dd>


<dt>silently_exclude_na_when</dt>
<dd><p>An expression that returns a logical value,
specifying the circumstances when <code>NA</code> values should be automatically
excluded.</p></dd>


<dt>silently_exclude_when</dt>
<dd><p>An expression that returns a logical value,
specifying the circumstances when values should be automatically
excluded</p></dd>


<dt>censoring_fn</dt>
<dd><p>A function specifying the value of the <code>censoring</code> column</p></dd>


<dt>value_as_number_fn</dt>
<dd><p>A function specifying how to generate the
<code>value_as_number</code> column</p></dd>


<dt>value_as_character_fn</dt>
<dd><p>A function specifying how to generate the
<code>value_as_character</code> column</p></dd>


<dt>value_as_logical_fn</dt>
<dd><p>A function specifying how to generate the
<code>value_as_logical</code> column</p></dd>


<dt>unit_rescale_fn</dt>
<dd><p>A function specifying how to rescale the flowsheet
values. By default, does not rescale</p></dd>


<dt>unit_relabel_fn</dt>
<dd><p>A function specifying how to relabel the units of the
the flowsheet values. By default, does not rescale</p></dd>


<dt>coalesce_fn</dt>
<dd><p>A function specifying how to combine measurements from
exactly the same time</p></dd>


<dt>expect_before</dt>
<dd><p>An expression that returns a logical value,
specifying a condition that should be <code>TRUE</code> in the raw data</p></dd>


<dt>expect_after</dt>
<dd><p>An expression that returns a logical value,
specifying a condition that should be <code>TRUE</code> in the processed (output) data</p></dd>


<dt>range_mainly_low, range_mainly_high</dt>
<dd><p>An indicative lower and upper range
for most values. Values outside this range are NOT excluded: this is purely
for setting default scales of plots etc</p></dd>


<dt>range_discard_below, range_discard_above</dt>
<dd><p>This pair set the lower and
upper range for the flowsheet item. Values outside this range are
EXCLUDED.</p></dd>


<dt>x</dt>
<dd><p>Flowsheet data in renamed format (after applying <code>fsheet_rename</code>)</p></dd>


<dt>errors</dt>
<dd><p>A function indicating what to do when an error is found</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><code>fsheet_add</code> returns a list of fsheet definitions, with the new definition
added to the end of the supplied fsheet_def</p>


<p><code>fsheet_extract</code> returns a data frame with the following columns:
<code>person_id</code>, <code>symbol</code>, <code>value_as_character</code>, <code>value_as_number</code>,
<code>value_as_logical</code>, <code>censoring</code>, <code>comment</code>, <code>measurement_datetime</code>, <code>name</code>,
<code>title</code>, <code>data_id</code>, <code>measurement_id</code>, <code>line_id</code>, <code>template</code>, <code>form</code>, <code>type</code>,
<code>unit</code></p>


    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Flowsheet defintiions describe how the raw data should be extracted,
filtered, cleaned and standardised as follows:</p><ol><li><p><strong>Labelling the flowsheet item</strong>. Two names/labels are required each
fsheet item:</p><ul><li><p>a <code>symbol</code>, which serves as the "R variable name" for the item. To make
the symbol quick and easy to type, and work with in R, it is
recommended that these are lowercase, ideally single words (e.g.
<code>"news2"</code> or "<code>spo2</code>)</p></li>
<li><p>a <code>title</code>, which serves as the label the of the flowsheet item in
plots and figures. This should be capitalised as you would want the
item to be labelled in formal documents (e.g. <code>"NEWS2"</code> or <code>"SpO2</code>).</p></li>
</ul></li>
<li><p><strong>Extracting relevant flowsheet items</strong> The specification of which
rows should be extracted is via:</p><ul><li><p><code>names</code>, a vector listing the labels of the fsheet items in the raw
data. This corresponds to column labelled as <code>name</code> by
<code><a href="rename.html">fsheet_rename</a></code>, which is labelled as <code>disp_name</code> in the raw
extracts from Epic).</p></li>
</ul><p>Additionally, to guard against the potential for new names for flowsheet
items being introduced through the evolution of the EHR data, search terms
for potential other names for this flowsheet items (and known exclusions)
can be provided using:</p><ul><li><p><code>search_pattern</code>, a vector of search terms of potential synonyms for
the flowsheet item. This list of search terms will be searched
whenever the flowsheet item is extracted, and if a possible new data
field is identified, then this will be alerted to the user.</p></li>
<li><p><code>search_exclude</code>, a vector of names of flowsheet items that are known
<em>not</em> to be relevant. This list of names will be removed prior to
searching the data for the search patterns in <code>search_pattern</code>.
This helps to avoid alerting the user about numerous flowsheet items
that are known to be irrelevant.</p></li>
</ul></li>
<li><p><strong>Excluding rows</strong>. Rows containing <code>NA</code> in the <code>value</code> column may be
always irrelevant, so it may be helpful to remove these by setting
<code>silently_exclude_na_when</code> to <code>TRUE</code>.</p>
<p>Alternatively, an expression that describes when row should be excluded
can be provided using <code>silently_exclude_when</code>. For example, setting this
to <code>(value_original == "Other (Comment)")</code> will exclude all rows where the
value is <code>"Other (Comment)"</code>.</p>
<p>For numerical flowsheet items,<code>range_discard_below</code> and
<code>range_discard_above</code> can be specified so that values outside this range
are excluded (see below for details).</p></li>
<li><p><strong>Converting values to numbers/characters/logicals</strong>. Raw flowsheet data
are a complex mix of numerical data (sometimes containing censoring, and
other non-numerical data), categorical data (coded as characters) and
logical data (usually coded as characters). Standardising the raw data
into data of a single type makes downstream analysis easier, so several
aspects of the definition specify how this is done:</p><ul><li><p><code>type</code>: one of <code>numeric</code>, <code>character</code> or <code>logical</code>. This is used to
set sensible defaults for other aspects of the specification, and is
added as a column to the output, so downstream handling of the data
can use this column to determine handling of the data (e.g. default
plots might be a barplot for <code>character</code> items and a lineplot for
<code>numeric</code> items)</p></li>
<li><p><code>value_as_number_fn</code>, <code>value_as_character_fn</code> and <code>value_as_logical_fn</code>
enable functions that handle conversion of the raw data.
<strong>TODO add more details</strong></p></li>
<li><p><code>unit_rescale_fn</code> and <code>unit_relabel_fn</code> enable functions that standardise
the units to be provided</p></li>
<li><p><code>coalesce_fn</code> enables a function that combines together data to be
provided. For instance, this can be used to specify how simultaneous data
should be combined: e.g. how should two blood pressure records at
the exact same time be handled? The function can describe how to combine
the information by e.g. taking the mean or max, or arbitrarily choosing
one of the records.</p></li>
</ul></li>
<li><p><strong>Validating that data conform to expectations</strong>. Two parameters enable
checking that the data comply with known restrictions. For example, we
may know a finite range exists for a flowsheet item, and we want to check
that all data fall within this range.</p>
<p>Alternatively, we may need to map each value of the raw data to a smaller
range of values, and we need to be sure that our function for doing this
handles all the values that are present in the raw data (i.e. no new
values have been added).</p>
<p>Checks that should be performed on the raw data should be supplied as
<code>expect_before</code>, whereas checks that should be performed on the cleaned
data should be supplied as <code>expect_after</code>.</p></li>
<li><p><strong>Specification of ranges</strong>. Two types of ranges can be specified:</p><ul><li><p><code>range_discard_below</code> and <code>range_discard_above</code>: these are intended to
describe <em>hard</em> limits: values outside this range will be <em>excluded</em>.</p></li>
<li><p><code>range_mainly_low</code> and <code>range_mainly_high</code>: these are intended to
describe the range of values we typically expect most of the data to
fall within, which can be useful for setting default ranges for e.g.
default plots. Values outside this range are <em>not excluded</em>.</p></li>
</ul></li>
</ol></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>R.J.B. Goudie</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># A definition for the NEWS2 score:</span></span></span>
<span class="r-in"><span><span class="co"># - Includes the value of the flowsheet called "NEWS 2 score"</span></span></span>
<span class="r-in"><span><span class="co"># - Excludes all NA values, and also " " and "E".</span></span></span>
<span class="r-in"><span><span class="co"># - The value_as_number_fn will convert "3mm" to 3, since this is probably</span></span></span>
<span class="r-in"><span><span class="co">#   a typo</span></span></span>
<span class="r-in"><span><span class="co"># - Checks that all output values are in integers between 0 and 17.</span></span></span>
<span class="r-in"><span><span class="va">fsheet_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">fsheet_add</span><span class="op">(</span></span></span>
<span class="r-in"><span>    symbol <span class="op">=</span> <span class="st">"news2"</span>,</span></span>
<span class="r-in"><span>    title <span class="op">=</span> <span class="st">"NEWS2"</span>,</span></span>
<span class="r-in"><span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NEWS2 score"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    search_pattern <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"news2"</span>, <span class="st">"news"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    search_exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    silently_exclude_na_when <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    silently_exclude_when <span class="op">=</span></span></span>
<span class="r-in"><span>      <span class="op">(</span><span class="va">value_original</span> <span class="op">==</span> <span class="st">" "</span> <span class="op">|</span></span></span>
<span class="r-in"><span>         <span class="va">value_original</span> <span class="op">==</span> <span class="st">"E"</span> <span class="co"># some kind of typo</span></span></span>
<span class="r-in"><span>      <span class="op">)</span>,</span></span>
<span class="r-in"><span>    value_as_number_fn <span class="op">=</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">value_original</span> <span class="op">==</span> <span class="st">"3mm"</span> <span class="op">~</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">value_as_number</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    expect_after <span class="op">=</span></span></span>
<span class="r-in"><span>      <span class="op">(</span><span class="va">value_as_number</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">0</span><span class="op">:</span><span class="fl">17</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note that person_id == "BB" has a NEWS2 with value="3mm", and that</span></span></span>
<span class="r-in"><span><span class="co"># person_id == "CC" has a NEWS2 with NA value</span></span></span>
<span class="r-in"><span><span class="va">fsheet_raw_example</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 31 × 10</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    person_id  data_id line_id measurement_id measurement_datetime name               value comment template  form       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> AA               5      61 1234           2021-01-03 <span style="color: #949494;">17:00:00</span>  Weight             4125  <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> AA        10<span style="text-decoration: underline;">909</span>029      60 10             2021-01-01 <span style="color: #949494;">10:59:00</span>  SpO2               96    <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> AA        10<span style="text-decoration: underline;">909</span>029      60 10             2021-01-02 <span style="color: #949494;">08:59:00</span>  SpO2               90    <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> AA        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-01 <span style="color: #949494;">09:30:00</span>  NEWS2 score        3     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> AA        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-01 <span style="color: #949494;">12:30:00</span>  NEWS2 score        4     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> AA        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-01 <span style="color: #949494;">09:00:00</span>  NEWS2 score        3     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> AA        10<span style="text-decoration: underline;">909</span>029      60 10             2021-01-05 <span style="color: #949494;">11:30:00</span>  SpO2               96    <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> AA        10<span style="text-decoration: underline;">909</span>029      60 10             2021-01-05 <span style="color: #949494;">16:30:00</span>  SpO2               90    <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> AA        10<span style="text-decoration: underline;">909</span>029      60 10             2021-01-06 <span style="color: #949494;">10:30:00</span>  SpO2               92    <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> AA        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-05 <span style="color: #949494;">11:30:00</span>  NEWS2 score        3     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span> AA        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-05 <span style="color: #949494;">16:30:00</span>  NEWS2 score        6     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span> AA        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-06 <span style="color: #949494;">10:30:00</span>  NEWS2 score        3     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">13</span> BB        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-19 <span style="color: #949494;">08:59:00</span>  Weight             4000  <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">14</span> BB               5      61 1234           2021-01-20 <span style="color: #949494;">09:00:00</span>  Weight             4035  <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">15</span> BB               5      61 1234           2021-01-20 <span style="color: #949494;">08:59:00</span>  Weight             4025  <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">16</span> BB               5      61 1234           2021-01-25 <span style="color: #949494;">08:59:00</span>  Weight             4000  <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">17</span> BB        10<span style="text-decoration: underline;">909</span>029      60 10             2021-01-24 <span style="color: #949494;">09:00:00</span>  NEWS2/MEOWS: ACVPU A     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">18</span> BB        10<span style="text-decoration: underline;">909</span>029      60 10             2021-01-24 <span style="color: #949494;">09:00:00</span>  NEWS2/MEOWS: ACVPU P     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">19</span> BB        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-21 <span style="color: #949494;">09:30:00</span>  NEWS2 score        3     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">20</span> BB        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-22 <span style="color: #949494;">12:30:00</span>  NEWS2 score        4     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">21</span> BB        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-23 <span style="color: #949494;">09:00:00</span>  NEWS2 score        3mm   <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">22</span> BB        10<span style="text-decoration: underline;">909</span>029      60 10             2021-01-21 <span style="color: #949494;">08:59:00</span>  SpO2               93    <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">23</span> BB        10<span style="text-decoration: underline;">909</span>029      60 10             2021-01-23 <span style="color: #949494;">08:59:00</span>  SpO2               85    <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">24</span> BB        10<span style="text-decoration: underline;">909</span>029      60 10             2021-01-26 <span style="color: #949494;">12:59:00</span>  SpO2               80    <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">25</span> BB        10<span style="text-decoration: underline;">909</span>029      60 10             2021-02-01 <span style="color: #949494;">19:00:00</span>  SpO2               30    <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">26</span> CC        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-01 <span style="color: #949494;">08:59:00</span>  NEWS2 score        5     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">27</span> CC        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-03 <span style="color: #949494;">17:00:00</span>  NEWS2 score        7     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">28</span> CC        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-04 <span style="color: #949494;">09:00:00</span>  NEWS2 score        6     <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">29</span> CC        10<span style="text-decoration: underline;">926</span>333     239 1234           2021-01-02 <span style="color: #949494;">08:59:00</span>  NEWS2 score        <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">30</span> CC        10<span style="text-decoration: underline;">909</span>029      60 10             <span style="color: #BB0000;">NA</span>                   SpO2               93    <span style="color: #BB0000;">NA</span>      IP Vitals Vital signs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">31</span> <span style="color: #BB0000;">NA</span>              <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>         </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note that the NA row is excluded, and that "3mm" is converted to 3</span></span></span>
<span class="r-in"><span><span class="fu">fsheet_extract</span><span class="op">(</span><span class="va">fsheet_raw_example</span>, <span class="va">fsheet_def</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Extracting NEWS2 (news2) from 13 raw rows</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> 1 row removed since value was NA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> 12 rows extracted</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 17</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    person_id symbol measurement_datetime value_as_number censoring value_as_logical value_as_character name        unit  type    template  form         data_id line_id measurement_id title comment</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> CC        news2  2021-01-01 <span style="color: #949494;">08:59:00</span>                5 <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                 NEWS2 score <span style="color: #BB0000;">NA</span>    numeric IP Vitals Vital signs 10<span style="text-decoration: underline;">926</span>333     239 1234           NEWS2 <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> AA        news2  2021-01-01 <span style="color: #949494;">09:00:00</span>                3 <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                 NEWS2 score <span style="color: #BB0000;">NA</span>    numeric IP Vitals Vital signs 10<span style="text-decoration: underline;">926</span>333     239 1234           NEWS2 <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> AA        news2  2021-01-01 <span style="color: #949494;">09:30:00</span>                3 <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                 NEWS2 score <span style="color: #BB0000;">NA</span>    numeric IP Vitals Vital signs 10<span style="text-decoration: underline;">926</span>333     239 1234           NEWS2 <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> AA        news2  2021-01-01 <span style="color: #949494;">12:30:00</span>                4 <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                 NEWS2 score <span style="color: #BB0000;">NA</span>    numeric IP Vitals Vital signs 10<span style="text-decoration: underline;">926</span>333     239 1234           NEWS2 <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> CC        news2  2021-01-03 <span style="color: #949494;">17:00:00</span>                7 <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                 NEWS2 score <span style="color: #BB0000;">NA</span>    numeric IP Vitals Vital signs 10<span style="text-decoration: underline;">926</span>333     239 1234           NEWS2 <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> CC        news2  2021-01-04 <span style="color: #949494;">09:00:00</span>                6 <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                 NEWS2 score <span style="color: #BB0000;">NA</span>    numeric IP Vitals Vital signs 10<span style="text-decoration: underline;">926</span>333     239 1234           NEWS2 <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> AA        news2  2021-01-05 <span style="color: #949494;">11:30:00</span>                3 <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                 NEWS2 score <span style="color: #BB0000;">NA</span>    numeric IP Vitals Vital signs 10<span style="text-decoration: underline;">926</span>333     239 1234           NEWS2 <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> AA        news2  2021-01-05 <span style="color: #949494;">16:30:00</span>                6 <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                 NEWS2 score <span style="color: #BB0000;">NA</span>    numeric IP Vitals Vital signs 10<span style="text-decoration: underline;">926</span>333     239 1234           NEWS2 <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> AA        news2  2021-01-06 <span style="color: #949494;">10:30:00</span>                3 <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                 NEWS2 score <span style="color: #BB0000;">NA</span>    numeric IP Vitals Vital signs 10<span style="text-decoration: underline;">926</span>333     239 1234           NEWS2 <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> BB        news2  2021-01-21 <span style="color: #949494;">09:30:00</span>                3 <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                 NEWS2 score <span style="color: #BB0000;">NA</span>    numeric IP Vitals Vital signs 10<span style="text-decoration: underline;">926</span>333     239 1234           NEWS2 <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span> BB        news2  2021-01-22 <span style="color: #949494;">12:30:00</span>                4 <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                 NEWS2 score <span style="color: #BB0000;">NA</span>    numeric IP Vitals Vital signs 10<span style="text-decoration: underline;">926</span>333     239 1234           NEWS2 <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span> BB        news2  2021-01-23 <span style="color: #949494;">09:00:00</span>                3 <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>                 NEWS2 score <span style="color: #BB0000;">NA</span>    numeric IP Vitals Vital signs 10<span style="text-decoration: underline;">926</span>333     239 1234           NEWS2 <span style="color: #BB0000;">NA</span>     </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by R.J.B Goudie.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

